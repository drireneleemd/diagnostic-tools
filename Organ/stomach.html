<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Radiology Diagnostic Suite - Stomach</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/dist/tippy.css">
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/dist/themes/light-border.css">
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f8fafc; margin: 20px; }
        .container { max-width: 1400px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h1, h2 { color: #1e293b; text-align: center; }
        .card { border: 1px solid #e2e8f0; padding: 20px; border-radius: 8px; margin-bottom: 25px; background: #ffffff; }
        .calc-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 15px; }
        label { display: block; font-size: 0.85rem; font-weight: bold; margin-bottom: 5px; color: #475569; }
        select { padding: 10px; border: 1px solid #cbd5e1; border-radius: 4px; width: 100%; box-sizing: border-box; background: #fff; }
        .result-box { background: #f1f5f9; padding: 20px; border-radius: 8px; border-left: 5px solid #0f172a; margin-top: 15px; white-space: pre-line; line-height: 1.5; display: none; }
        .mermaid { display: flex; justify-content: center; overflow-x: auto; padding: 10px; min-height: 1200px; }

        .tippy-box[data-theme~='light-border'] {
            background-color: #ffffff !important;
            color: #1e293b !important;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            font-size: 0.95rem;
            border: 1px solid #cbd5e1;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Stomach Diagnostic Suite</h1>

    <div class="card">
        <h2>Clinical Decision Support</h2>
        <div class="calc-grid">
            <div>
                <label>Primary Imaging Feature</label>
                <select id="primaryFeature" onchange="updateSecondaryOptions()">
                    <option value="none">Select primary feature...</option>
                    <option value="wall">Branch 1: WALL THICKNESS Pattern</option>
                    <option value="enhancement">Branch 2: SUBMUCOSAL Enhancement</option>
                    <option value="growth">Branch 3: GROWTH Pattern</option>
                    <option value="nodes">Branch 4: LYMPHADENOPATHY</option>
                    <option value="location">Branch 5: LOCATION Distribution</option>
                    <option value="signs">Branch 6: SPECIFIC Imaging Signs</option>
                    <option value="ulcer">Branch 7: ULCERATION & Perforation</option>
                    <option value="gas">Branch 8: INTRAMURAL GAS</option>
                </select>
            </div>
            <div>
                <label>Sub-branch / Key Morphology</label>
                <select id="secondaryFeature">
                    <option value="none">Please select primary first...</option>
                </select>
            </div>
            <div>
                <label>Anatomic Location (Optional)</label>
                <select id="locationFilter">
                    <option value="any">Unspecified / Any</option>
                    <option value="cardia">Cardia / Gastroesophageal Junction</option>
                    <option value="fundus">Fundus / Body</option>
                    <option value="antrum">Antrum / Pylorus</option>
                </select>
            </div>
        </div>
        <button onclick="analyzeStomach()" style="width: 100%; background: #0f172a; color: white; border: none; padding: 12px; border-radius: 4px; cursor: pointer; font-weight: bold;">Analyze Gastric Findings</button>
        <div class="result-box" id="result"></div>
    </div>

    <div class="card">
        <h2>Diagnostic Mind Map (Hover for Details)</h2>
        <div class="mermaid">
        graph TD
            Root((Stomach Lesion)) --- B1[Branch 1: Wall Thickness]
            Root --- B2[Branch 2: Submucosal Enhancement]
            Root --- B3[Branch 3: Growth Pattern]
            Root --- B6[Branch 6: Specific Signs]

            %% Branch 1
            B1 --- B1A(1A: Focal Segmental)
            B1A --- GAC1[Gastric Adenocarcinoma]
            B1A --- GIST1[Gastrointestinal Stromal Tumor]
            B1A --- LYM1[Gastric Lymphoma]
            B1 --- B1B(1B: Diffuse Symmetric)
            B1B --- GS1[Gastritis]
            B1B --- LP1[Linitis Plastica]
            B1B --- MD1[Ménétrier Disease]

            %% Branch 2
            B2 --- B2A(2A: Intense Homogeneous)
            B2A --- GLM[Glomus Tumor]
            B2A --- CAR[Carcinoid Tumor]
            B2 --- B2B(2B: Moderate Homogeneous)
            B2B --- LEI[Leiomyoma]
            B2B --- SCH[Schwannoma]
            B2 --- B2C(2C: Heterogeneous)
            B2C --- GIST2[Gastrointestinal Stromal Tumor]
            B2 --- B2D(2D: Fat Attenuation)
            B2D --- LIP[Lipoma]

            %% Branch 3
            B3 --- B3A(3A: Exophytic)
            B3A --- GIST3[Gastrointestinal Stromal Tumor]
            B3A --- LMS[Leiomyosarcoma]
            B3 --- B3B(3B: Endophytic)
            B3B --- PAC[Polypoid Adenocarcinoma]
            B3B --- POL[Gastric Polyps]
            B3 --- B3C(3C: Infiltrative)
            B3C --- LP2[Linitis Plastica]

            %% Branch 6
            B6 --- B6A(6A: Target Sign)
            B6A --- GS2[Gastritis]
            B6 --- B6B(6B: Bull's Eye Sign)
            B6B --- EPA[Ectopic Pancreas]
            B6B --- MET[Metastasis]
            B6 --- B6C(6C: Ulcer Crater Signs)
            B6C --- BPU[Benign Peptic Ulcer]
            B6C --- MALU[Malignant Ulcer]

            class GAC1 gac_s; class GIST1,GIST2,GIST3 gist_s; class LYM1 lym_s;
            class GS1,GS2 gs_s; class LP1,LP2 lp_s; class MD1 md_s;
            class GLM glm_s; class CAR car_s; class LEI lei_s; class SCH sch_s;
            class LIP lip_s; class LMS lms_s; class PAC pac_s; class POL pol_s;
            class EPA epa_s; class MET met_s; class BPU bpu_s; class MALU malu_s;
        </div>
    </div>
</div>

<script>
    mermaid.initialize({ startOnLoad: true, theme: 'neutral', securityLevel: 'loose' });

    const optionsMap = {
        "none": ["Please select primary first..."],
        "wall": ["1A: Focal / Segmental Thickening (≥1 cm)", "1B: Diffuse Symmetric Thickening"],
        "enhancement": ["2A: Intense Homogeneous", "2B: Moderate Homogeneous", "2C: Heterogeneous", "2D: Fat Attenuation"],
        "growth": ["3A: Exophytic (Extraluminal)", "3B: Endophytic (Intraluminal)", "3C: Infiltrative"],
        "nodes": ["4A: Significant Lymphadenopathy Present", "4B: No Significant Lymphadenopathy"],
        "location": ["5A: Fundus / Body", "5B: Antrum / Pylorus", "5C: Cardia / Gastroesophageal Junction"],
        "signs": ["6A: Target Sign (Layered Enhancement)", "6B: Bull's-Eye Sign", "6C: Hampton's Line / Carman Meniscus"],
        "ulcer": ["7A: Uncomplicated Ulcer", "7B: Perforated (Pneumoperitoneum)", "7C: Hemorrhagic"],
        "gas": ["8A: Emphysematous Gastritis (Critical)", "8B: Gastric Emphysema (Benign)"]
    };

    function updateSecondaryOptions() {
        const prim = document.getElementById('primaryFeature').value;
        const secSelect = document.getElementById('secondaryFeature');
        secSelect.innerHTML = "";
        optionsMap[prim].forEach(opt => {
            let el = document.createElement("option");
            el.textContent = opt;
            el.value = opt.toLowerCase().replace(/[\/\s-]/g, "_");
            secSelect.appendChild(el);
        });
    }

    const descriptions = {
        ".gac_s": "<b>Gastric Adenocarcinoma</b>: Focal eccentric thickening, soft tissue attenuation, nodular enhancement, and perigastric lymphadenopathy.",
        ".gist_s": "<b>Gastrointestinal Stromal Tumor</b>: Well-defined mass with exophytic growth; characteristic absence of significant lymphadenopathy.",
        ".lym_s": "<b>Gastric Lymphoma</b>: Focal or diffuse thickening; can be markedly thick (>3 cm) while preserving peristalsis; nodes below renal veins favor lymphoma.",
        ".gs_s": "<b>Gastritis</b>: Symmetric thickening with low attenuation submucosal edema; 'Target Sign' (layered enhancement) on CT.",
        ".lp_s": "<b>Linitis Plastica</b>: Diffuse infiltrative adenocarcinoma; 'leather bottle' appearance with loss of gastric distensibility.",
        ".md_s": "<b>Ménétrier Disease</b>: Markedly thickened folds (>1-2 cm) in the fundus/body; characteristically spares the antrum.",
        ".glm_s": "<b>Glomus Tumor</b>: Small (<2 cm) antral mass with intense arterial enhancement and tiny fleck calcifications.",
        ".car_s": "<b>Carcinoid Tumor</b>: Well-defined, intensely enhancing submucosal mass; may be multiple.",
        ".lei_s": "<b>Leiomyoma</b>: Smooth margins, homogeneous moderate enhancement, typically small (<5 cm).",
        ".sch_s": "<b>Schwannoma</b>: Homogeneous enhancement; larger lesions may show cystic degeneration.",
        ".lip_s": "<b>Lipoma</b>: Fat attenuation (-50 to -150 Hounsfield Units) with smooth margins.",
        ".lms_s": "<b>Leiomyosarcoma</b>: Exophytic growth, heterogeneous enhancement, and possible calcification.",
        ".pac_s": "<b>Polypoid Adenocarcinoma</b>: Intraluminal mass projecting with an irregular surface.",
        ".pol_s": "<b>Gastric Polyps</b>: Smooth surface with homogeneous enhancement.",
        ".epa_s": "<b>Ectopic Pancreas</b>: Antral submucosal mass with a central umbilication ('Bull's-Eye' sign).",
        ".met_s": "<b>Metastasis</b>: Central necrosis common in melanoma, breast, or lung metastases ('Bull's-Eye' sign).",
        ".bpu_s": "<b>Benign Peptic Ulcer</b>: Hampton's line present; crater projects beyond gastric contour.",
        ".malu_s": "<b>Malignant Ulcer</b>: Carman meniscus sign (convex border toward lumen); crater located within a mass."
    };

    const allDiseases = [
        { name: "Gastric Adenocarcinoma", features: ["focal", "segmental", "nodes", "antrum", "cardia", "meniscus", "irregular"], locs: ["antrum", "pylorus", "cardia"], desc: "Focal eccentric thickening, soft tissue attenuation, nodular enhancement, and lymphadenopathy." },
        { name: "Gastrointestinal Stromal Tumor (GIST)", features: ["focal", "heterogeneous", "exophytic", "fundus", "body", "no_nodes"], locs: ["fundus", "body"], desc: "Well-defined mass, exophytic growth, and characteristic absence of significant lymphadenopathy." },
        { name: "Gastric Lymphoma", features: ["focal", "diffuse", "nodes", "bulky"], locs: [], desc: "Marked thickening (>3 cm) with preserved peristalsis; bulky nodes below renal veins suggest this over adenocarcinoma." },
        { name: "Gastritis", features: ["diffuse", "symmetric", "low_attenuation", "target"], locs: [], desc: "Symmetric thickening, mucosal hyperenhancement, and 'Target Sign' layered edema." },
        { name: "Linitis Plastica", features: ["diffuse", "infiltrative", "distensibility"], locs: [], desc: "Diffuse infiltrative adenocarcinoma; 'leather bottle' appearance with marked wall thickening." },
        { name: "Ménétrier Disease", features: ["diffuse", "folds", "fundus", "body"], locs: ["fundus", "body"], desc: "Markedly thickened folds (>1-2 cm) predominantly in the fundus/body; characteristically spares the antrum." },
        { name: "Glomus Tumor", features: ["intense", "antrum", "calcification"], locs: ["antrum"], desc: "Small (<2 cm) with intense arterial enhancement and fleck calcifications in the antrum." },
        { name: "Carcinoid Tumor", features: ["intense", "submucosal"], locs: [], desc: "Well-defined submucosal mass with intense homogeneous enhancement." },
        { name: "Leiomyoma", features: ["moderate", "small"], locs: [], desc: "Small (<5 cm), smooth margins, and moderate homogeneous enhancement." },
        { name: "Schwannoma", features: ["moderate", "cystic"], locs: [], desc: "Moderate homogeneous enhancement; cystic degeneration possible in larger lesions." },
        { name: "Lipoma", features: ["fat", "hounsfield"], locs: [], desc: "Fat attenuation (-50 to -150 Hounsfield Units) with smooth margins." },
        { name: "Ectopic Pancreas", features: ["antrum", "umbilication", "bulls_eye"], locs: ["antrum"], desc: "Antral submucosal mass with central umbilication ('Bull's-Eye' sign)." },
        { name: "Benign Peptic Ulcer", features: ["uncomplicated", "hampton", "edema"], locs: [], desc: "Hampton's line (thin radiolucent line); crater projects beyond the gastric contour." },
        { name: "Emphysematous Gastritis", features: ["gas", "life_threatening"], locs: [], desc: "Intramural gas with inflammation; life-threatening condition requiring urgent treatment." }
    ];

    function analyzeStomach() {
        const prim = document.getElementById('primaryFeature').value;
        const sec = document.getElementById('secondaryFeature').value;
        const loc = document.getElementById('locationFilter').value;
        const resBox = document.getElementById('result');
        
        if (prim === "none") return;

        let filtered = allDiseases.filter(d => {
            const featureMatch = d.features.some(f => sec.includes(f) || prim.includes(f));
            if (loc !== "any" && d.locs.length > 0) {
                return featureMatch && d.locs.includes(loc);
            }
            return featureMatch;
        });

        if (filtered.length > 0) {
            let res = `<b>Differential Diagnosis for this Imaging Pattern:</b>\n\n` + 
                      filtered.map(d => `• <b>${d.name}</b>: ${d.desc}`).join("\n\n");
            resBox.innerHTML = res.replace(/\n/g, "<br>");
            resBox.style.borderLeftColor = "#0ea5e9";
        } else {
            resBox.innerHTML = "<b>No direct match in the current decision tree.</b><br>Try broadening your morphological or location parameters.";
            resBox.style.borderLeftColor = "#64748b";
        }
        resBox.style.display = "block";
    }

    setTimeout(() => {
        Object.keys(descriptions).forEach(className => {
            tippy(className, {
                allowHTML: true,
                theme: 'light-border',
                content: descriptions[className],
                placement: 'top',
                animation: 'fade'
            });
        });
    }, 1200);
</script>
</body>
</html>