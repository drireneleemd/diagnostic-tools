<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Radiology Diagnostic Portal</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/dist/tippy.css">
    
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: white; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 280px; background: #1e293b; padding: 20px; border-right: 1px solid #334155; display: flex; flex-direction: column; }
        .sidebar h2 { font-size: 1.2rem; color: #38bdf8; margin-bottom: 30px; border-bottom: 1px solid #334155; padding-bottom: 10px; }
        #nav-container { flex-grow: 1; }
        .nav-btn { width: 100%; background: transparent; border: 1px solid #334155; color: #cbd5e1; padding: 12px; margin-bottom: 10px; border-radius: 6px; cursor: pointer; text-align: left; transition: 0.2s; text-transform: capitalize; }
        .nav-btn:hover { background: #334155; color: white; }
        .nav-btn.active { background: #0ea5e9; color: white; border-color: #0ea5e9; }
        .main-content { flex: 1; position: relative; background: #f8fafc; }
        iframe { width: 100%; height: 100%; border: none; }
        .welcome-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #f8fafc; color: #64748b; z-index: 5; text-align: center; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>Diagnostic Portal</h2>
        <div id="nav-container">
            </div>
        <div style="margin-top: auto; font-size: 0.75rem; color: #64748b;">
            System: Master Meta-Site<br>Auto-Discovery Simulation
        </div>
    </div>

    <div class="main-content">
        <div id="welcome" class="welcome-screen">
            <div>
                <h2 style="font-size: 2rem; margin-bottom: 10px;">Imaging Support System</h2>
                <p>Select a organ from the sidebar to begin.</p>
            </div>
        </div>
        <iframe id="toolFrame" src="about:blank"></iframe>
    </div>

    <script>
        // --- STEP 1: ONLY EDIT THIS LIST ---
        // Just add the filename (without .html) here.
        const organFiles = ['brain', 'spinal_cord', 'bones', 
                            'lungs', 'heart', 'mediastinum', 'pleura/chest_wall', 'vessels',
                            'adrenal_glands', 'liver', 'kidneys', 'pancreas', 'spleen', 'urinary_bladder', 
                            'uterus/adenexas', 'prostate/seminal_vesicles',
                            'soft_tissue', 'lymph_nodes']; 

        // --- STEP 2: AUTO-GENERATION LOGIC ---
        const navContainer = document.getElementById('nav-container');
        
        organFiles.forEach(fileName => {
            const btn = document.createElement('button');
            btn.className = 'nav-btn';
            let cleanName = fileName.replace(/[_-]/g, ' ')
                            .split(' ')
                            .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                            .join(' ');
            btn.innerText = cleanName;
        btn.onclick = () => loadTool(`Organ/${fileName}.html`, btn);
            navContainer.appendChild(btn);
        });

        // --- STEP 3: THE MASTER WRAPPER LOGIC ---
        mermaid.initialize({ startOnLoad: false, theme: 'neutral', securityLevel: 'loose' });

        function loadTool(url, btn) {
            document.getElementById('welcome').style.display = 'none';
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            const frame = document.getElementById('toolFrame');
            frame.src = url;

            frame.onload = function() {
                const innerDoc = frame.contentDocument || frame.contentWindow.document;
                const mermaidDiv = innerDoc.querySelector('.mermaid');
                
                if (mermaidDiv) {
                    // This handles the timing issue you experienced
                    mermaid.init(undefined, mermaidDiv, function() {
                        // Apply tooltips to everything in the frame
                        tippy(innerDoc.querySelectorAll('.node'), {
                            content: (ref) => `<b>${ref.innerText.trim()}</b><br>Click to expand diagnostic path.`,
                            allowHTML: true,
                            appendTo: innerDoc.body
                        });
                        
                        // Map the clinical classes (adenoma, malig, etc) to your notes
                        const classes = {
                            '.adenoma': 'Low attenuation, rapid washout.',
                            '.malig': 'Requires oncology workup.',
                            '.infNode': 'Check inflammatory markers.',
                            '.benign': 'Classic imaging features, non-suspicious.'
                        };

                        Object.entries(classes).forEach(([selector, text]) => {
                            tippy(innerDoc.querySelectorAll(selector), { 
                                content: text, 
                                appendTo: innerDoc.body 
                            });
                        });
                    });
                }
            };
        }
    </script>
</body>
</html>