<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Radiology Diagnostic Portal</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/dist/tippy.css">
    
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: #0f172a; 
            color: white; 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            height: 100vh; 
            overflow: hidden; 
        }

        /* Top Navigation Bar */
        .header {
            height: 70px;
            background: #1e293b;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 40px;
            border-bottom: 1px solid #334155;
            z-index: 10;
        }

        .header h2 { 
            font-size: 1.5rem; 
            color: #38bdf8; 
            margin: 0; 
        }

        .home-btn {
            background: #0ea5e9;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
        }

        .home-btn:hover { background: #0284c7; }

        .main-content { 
            flex: 1; 
            position: relative; 
            background: #f8fafc; 
            overflow-y: auto; /* Allows scrolling if content is long */
        }

        iframe { width: 100%; height: 100%; border: none; display: none; }

        /* Dashboard View (Centered Organ List) */
        .dashboard {
            max-width: 1200px;
            margin: 60px auto;
            padding: 0 20px;
            text-align: center;
        }

        .dashboard h1 {
            color: #1e293b;
            font-size: 2.5rem;
            margin-bottom: 40px;
        }

        .organ-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            justify-content: center;
        }

        .nav-btn { 
            background: white; 
            border: 1px solid #e2e8f0; 
            color: #1e293b; 
            padding: 25px 15px; 
            border-radius: 12px; 
            cursor: pointer; 
            text-align: center; 
            transition: all 0.3s ease; 
            text-transform: capitalize;
            font-weight: 600;
            font-size: 1.1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .nav-btn:hover { 
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border-color: #0ea5e9;
            color: #0ea5e9;
        }

        .footer-info {
            margin-top: 50px;
            padding-bottom: 30px;
            font-size: 0.85rem;
            color: #94a3b8;
        }
    </style>
</head>
<body>

    <div class="header">
        <h2>Imaging Support System</h2>
        <button class="home-btn" onclick="showDashboard()">Home Portal</button>
    </div>

    <div class="main-content">
        <div id="dashboard" class="dashboard">
            <h1>Select Organ System</h1>
            <div id="organ-grid" class="organ-grid">
                </div>
            <div class="footer-info">
                System: Master Meta-Site | Auto-Discovery Simulation
            </div>
        </div>

        <iframe id="toolFrame" src="about:blank"></iframe>
    </div>

    <script>
        const organFiles = [
            'brain', 'spinal_cord', 'bones', 
            'lungs', 'heart', 'mediastinum', 'pleura/chest_wall', 'vessels',
            'adrenal_glands', 'liver', 'kidneys', 'pancreas', 'spleen', 'urinary_bladder', 
            'uterus/adenexas', 'prostate/seminal_vesicles',
            'soft_tissue', 'lymph_nodes'
        ]; 

        const gridContainer = document.getElementById('organ-grid');
        
        // Generate the Grid Buttons
        organFiles.forEach(fileName => {
            const btn = document.createElement('button');
            btn.className = 'nav-btn';
            
            // Format name: Replace underscores with spaces, but keep slashes
            let cleanName = fileName.replace(/_/g, ' ') 
                            .split('/')
                            .map(part => part.trim()
                                .split(' ')
                                .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                                .join(' ')
                            )
                            .join(' / '); // Re-joins with the slash preserved
            
            btn.innerText = cleanName;
            btn.onclick = () => loadTool(`Organ/${fileName}.html`);
            gridContainer.appendChild(btn);
        });

        mermaid.initialize({ startOnLoad: false, theme: 'neutral', securityLevel: 'loose' });

        function showDashboard() {
            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('toolFrame').style.display = 'none';
            document.getElementById('toolFrame').src = 'about:blank';
        }

        function loadTool(url) {
            document.getElementById('dashboard').style.display = 'none';
            const frame = document.getElementById('toolFrame');
            frame.style.display = 'block';
            frame.src = url;

            frame.onload = function() {
                const innerDoc = frame.contentDocument || frame.contentWindow.document;
                const mermaidDiv = innerDoc.querySelector('.mermaid');
                
                if (mermaidDiv) {
                    mermaid.init(undefined, mermaidDiv, function() {
                        tippy(innerDoc.querySelectorAll('.node'), {
                            content: (ref) => `<b>${ref.innerText.trim()}</b><br>Click to expand diagnostic path.`,
                            allowHTML: true,
                            appendTo: innerDoc.body
                        });
                        
                        const classes = {
                            '.adenoma': 'Low attenuation, rapid washout.',
                            '.malig': 'Requires oncology workup.',
                            '.infNode': 'Check inflammatory markers.',
                            '.benign': 'Classic imaging features, non-suspicious.'
                        };

                        Object.entries(classes).forEach(([selector, text]) => {
                            tippy(innerDoc.querySelectorAll(selector), { 
                                content: text, 
                                appendTo: innerDoc.body 
                            });
                        });
                    });
                }
            };
        }
    </script>
</body>
</html>